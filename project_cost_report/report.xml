<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Analytic line rows -->
    <template id="cost_report_body__analytic_line_details">
        <tr class="o_project_cost_report__level_3 o_project_cost_report__analytic_line" t-att-data-id="line.id">
            <td></td>
            <td>
                <span t-field="line.date"/>
            </td>
            <td>
                <span t-field="line.name"/>
            </td>
            <td class="text-right">
                <!-- Display hours for timesheets -->
                <span t-if="line.task_id" t-field="line.unit_amount" t-options="{'widget': 'float_time'}"/>

                <!-- Display units as float for other types of analytic lines -->
                <span t-if="not line.task_id" t-field="line.unit_amount"/>
                <span t-if="not line.task_id" t-field="line.product_uom_id.name"/>
            </td>
            <td class="text-right">
                <span t-field="line.amount" t-options='{"widget": "monetary", "display_currency": currency}'/>
            </td>
        </tr>
    </template>

    <!-- PRODUCTS -->
    <template id="cost_report_body__product_category">
        <tr class="o_project_cost_report__level_2">
            <td colspan="4">
                <span class="o_project_cost_report__product_category o_project_cost_report__link" t-att-data-id="category.id">
                    <i class="fa fa-caret-right" t-if="category.folded"></i>
                    <i class="fa fa-caret-down" t-if="not category.folded"></i>
                    <span t-raw="category.name"/>
                </span>
            </td>
            <td class="o_project_cost_report__product_total text-right" t-att-data-id="category.id" t-att-data-name="category.name">
                <span class="o_project_cost_report__link" t-raw="category.total" t-options='{"widget": "monetary", "display_currency": currency}'/>
            </td>
        </tr>
        <t t-if="not category.folded">
            <t t-foreach="category.lines" t-as="line">
                <t t-call="project_cost_report.cost_report_body__analytic_line_details"/>
            </t>
        </t>
    </template>

    <template id="cost_report_body__product_section">
        <tr class="o_project_cost_report__level_1" v-if="product_categories">
            <td colspan="4">Products</td>
            <td class="text-right">
                <span t-raw="product_total" t-options='{"widget": "monetary", "display_currency": currency}'/>
            </td>
        </tr>
        <t t-foreach="product_categories" t-as="category">
            <t t-call="project_cost_report.cost_report_body__product_category"/>
        </t>
    </template>

    <!-- TIME -->
    <template id="cost_report_body__time_category">
        <tr class="o_project_cost_report__level_2">
            <td colspan="3">
                <span class="o_project_cost_report__time_category o_project_cost_report__link" t-att-data-id="category.id">
                    <i class="fa fa-caret-right" t-if="category.folded"></i>
                    <i class="fa fa-caret-down" t-if="not category.folded"></i>
                    <span t-raw="category.name"/>
                </span>
            </td>
            <td class="o_project_cost_report__time_total_hours text-right" t-att-data-id="category.id" t-att-data-name="category.name">
                <span class="o_project_cost_report__link" t-raw="category.total_hours" t-options="{'widget': 'float_time'}"/>
            </td>
            <td class="o_project_cost_report__time_total text-right" t-att-data-id="category.id" t-att-data-name="category.name">
                <span class="o_project_cost_report__link" t-raw="category.total" t-options='{"widget": "monetary", "display_currency": currency}'/>
            </td>
        </tr>
        <t t-if="not category.folded">
            <t t-foreach="category.lines" t-as="line">
                <t t-call="project_cost_report.cost_report_body__analytic_line_details"/>
            </t>
        </t>
    </template>

    <template id="cost_report_body__time_section">
        <tr class="o_project_cost_report__level_1" v-if="time_categories">
            <td colspan="3">Time</td>
            <td class="text-right">
                <span t-raw="time_total_hours" t-options="{'widget': 'float_time'}"/>
            </td>
            <td class="text-right">
                <span t-raw="time_total" t-options='{"widget": "monetary", "display_currency": currency}'/>
            </td>
        </tr>
        <t t-foreach="time_categories" t-as="category">
            <t t-call="project_cost_report.cost_report_body__time_category"/>
        </t>
    </template>

    <!-- OUTSOURCING -->
    <template id="cost_report_body__outsourcing_category">
        <tr class="o_project_cost_report__level_2">
            <td colspan="4">
                <span class="o_project_cost_report__outsourcing_category o_project_cost_report__link" t-att-data-id="category.id">
                    <i class="fa fa-caret-right" t-if="category.folded"></i>
                    <i class="fa fa-caret-down" t-if="not category.folded"></i>
                    <span t-raw="category.name"/>
                </span>
            </td>
            <td class="o_project_cost_report__outsourcing_total text-right" t-att-data-id="category.id" t-att-data-name="category.name">
                <span class="o_project_cost_report__link" t-raw="category.total" t-options='{"widget": "monetary", "display_currency": currency}'/>
            </td>
        </tr>
        <t t-if="not category.folded">
            <t t-foreach="category.lines" t-as="line">
                <t t-call="project_cost_report.cost_report_body__analytic_line_details"/>
            </t>
        </t>
    </template>

    <template id="cost_report_body__outsourcing_section">
        <tr class="o_project_cost_report__level_1" v-if="outsourcing_categories">
            <td colspan="4">Outsourcing</td>
            <td class="text-right">
                <span t-raw="outsourcing_total" t-options='{"widget": "monetary", "display_currency": currency}'/>
            </td>
        </tr>
        <t t-foreach="outsourcing_categories" t-as="category">
            <t t-call="project_cost_report.cost_report_body__outsourcing_category"/>
        </t>
    </template>

    <!-- Main report body -->
    <template id="cost_report_body">
        <div class="container o_project_cost_report">
            <span class="text-left">
                <h2 class="o_project_cost_report__title">Cost Report</h2>
            </span>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr class="o_project_cost_report__level_1">
                            <th colspan="4">Item</th>
                            <th class="text-right">Cost</th>
                        </tr>
                        <tr class="o_project_cost_report__level_3">
                            <th class="o_project_cost_report__padding_column"></th>
                            <th>Date</th>
                            <th>Description</th>
                            <th class="text-right">Quantity</th>
                            <th class="text-right">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-call="project_cost_report.cost_report_body__product_section"/>
                        <t t-call="project_cost_report.cost_report_body__time_section"/>
                        <t t-call="project_cost_report.cost_report_body__outsourcing_section"/>
                    </tbody>
                </table>
            </div>
        </div>
    </template>

    <template id="assets_backend" name="cost_report assets" inherit_id="web.assets_backend">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/project_cost_report/static/src/js/report_action.js"></script>
            <link rel="stylesheet" type="text/less" href="/project_cost_report/static/src/less/cost_report.less"/>
        </xpath>
    </template>

    <template id="cost_report_html">
        <t t-call="project_cost_report.cost_report_body"/>
    </template>

    <template id="cost_report_pdf_assets" inherit_id="web.assets_common" active="True">
        <xpath expr="." position="inside">
            <link rel="stylesheet" href="/project_cost_report/static/src/less/cost_report.less" />
        </xpath>
    </template>

    <template id="cost_report_pdf">
        <t t-raw="'&lt;base href=%s&gt;' % base_url"/>
        <t t-call="web.html_container">
            <t t-call-assets="project_cost_report.cost_report_pdf_assets" t-js="False"/>
            <t t-call="project_cost_report.cost_report_body"/>
        </t>
    </template>

</odoo>
